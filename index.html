<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>DocSafe ‚Äî B√™ta V1 (gratuite)</title>
    <style>
      :root{
        --bg:#0b1222;--card:#0f1a36;--line:#253364;--text:#e6ecff;
        --muted:#9db2ff;--brand:#2563EB;--accent:#0ea5e9;
      }
      *{box-sizing:border-box}
      body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:var(--bg);color:var(--text)}
      .wrap{max-width:1000px;margin:0 auto;padding:28px 16px}
      .hero h1{font-size:32px;margin:0 0 6px}
      .hero p{margin:4px 0 0;color:var(--muted)}
      .banner{border:1px dashed var(--line);background:#09122a;padding:10px 12px;border-radius:10px;margin:16px 0;color:var(--muted);font-size:14px}
      .features{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin:16px 0}
      @media(min-width:900px){.features{grid-template-columns:repeat(4,1fr)}}
      .feat{background:#0d1630;border:1px solid var(--line);border-radius:12px;padding:12px;font-size:14px}
      .grid{display:grid;gap:16px;grid-template-columns:1fr;margin:16px 0}
      @media(min-width:900px){.grid{grid-template-columns:1.2fr .8fr}}
      .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:18px}
      .uploader{text-align:center}
      input[type=file]{display:block;margin:8px auto 12px;color:var(--text)}
      .btn{display:inline-block;background:var(--brand);color:#fff;text-decoration:none;padding:10px 16px;border:0;border-radius:10px;font-weight:700;cursor:pointer}
      .btn.alt{background:var(--accent);color:#001}
      .note{font-size:13px;color:var(--muted);margin-top:8px}
      .tabs{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
      .tab{border:1px solid var(--line);border-radius:999px;padding:6px 12px;font-size:13px;color:var(--muted)}
      footer{margin:26px 0;font-size:13px;color:var(--muted)}
      footer a{color:var(--muted)}
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="hero">
        <h1>DocSafe ‚Äî B√™ta V1 (gratuite)</h1>
        <p>Nettoyez vos documents avant envoi (parcours et vitesse).</p>
      </div>

      <div class="banner">
        B√™ta technique : nous renvoyons une copie ¬´ _cleaned ¬ª. Le nettoyage avanc√© (grammaire, typographie,
        m√©tadonn√©es, humanizer) arrive en V2/V3.
      </div>

      <div class="features">
        <div class="feat">‚ö° Simple ‚Äî 1 clic</div>
        <div class="feat">üöÄ Rapide ‚Äî imm√©diat</div>
        <div class="feat">üß© PDF/DOCX/PPTX/XLSX (+ TXT)</div>
        <div class="feat">üîí Aucune sauvegarde serveur (b√™ta)</div>
      </div>

      <div class="grid">
        <div class="card uploader">
          <h3 style="margin-top:0">Clean & Download</h3>
          <input id="file" type="file" />
          <button id="cleanBtn" class="btn">Nettoyer mon fichier</button>
          <div id="msg" class="note"></div>
          <div id="out" style="margin-top:12px"></div>
          <div class="note">Limites b√™ta : 25 MB max / fichier.</div>
        </div>

        <div class="card">
          <h3 style="margin-top:0">Rejoindre la b√™ta priv√©e</h3>
          <p class="note">Laissez votre email pour acc√©der aux nouveaut√©s.</p>
          <!-- Remplace ce lien par ton Google Form -->
          <a class="btn alt" href="https://forms.gle/" target="_blank" rel="noopener">Join the Beta</a>
        </div>
      </div>

      <div class="card">
        <h3 style="margin-top:0">Feuille de route</h3>
        <div class="tabs">
          <span class="tab">V1 (maintenant) : copie ¬´ _cleaned ¬ª + m√©tadonn√©es vid√©es (PDF/Office)</span>
          <span class="tab">V2 (4‚Äì6 sem.) : correction basique + rapport</span>
          <span class="tab">V3 (6‚Äì12 sem.) : humanizer anti-d√©tection IA + int√©grations Word/Outlook/Teams</span>
        </div>
      </div>

      <footer>
        Questions ? contact.docsafe@gmail.com ‚Ä¢
        <a href="/privacy.html">Confidentialit√©</a> ‚Ä¢
        <a href="/terms.html">Conditions</a>
      </footer>
    </div>

    <script>
      // ‚ö†Ô∏è Remplace par TON URL Render exacte :
      const API = "https://docsafe-backendv1.onrender.com";

      const fileEl = document.getElementById('file');
      const btn = document.getElementById('cleanBtn');
      const msg = document.getElementById('msg');
      const out = document.getElementById('out');

      // R√©veille Render (free plan) d√®s le chargement
      (async()=>{ try{ await fetch(API + "/health", {cache:"no-store"});}catch(e){} })();

      btn.onclick = async () => {
        out.innerHTML = "";
        const f = fileEl.files?.[0];
        if(!f){ msg.textContent = "Choisissez un fichier."; return; }
        if(f.size > 25 * 1024 * 1024){ msg.textContent = "Fichier trop volumineux (> 25 MB)."; return; }

        msg.textContent = "Traitement‚Ä¶";
        const form = new FormData(); 
        form.append("file", f);

        try {
          const r = await fetch(API + "/api/clean", { method:"POST", body: form });
          if(!r.ok){ 
            let err = "Erreur serveur"; 
            try{ err = (await r.json()).error || err; }catch{}; 
            throw new Error(err + " (HTTP " + r.status + ")"); 
          }

          // ‚≠ê R√©cup√®re le mini-rapport envoy√© par le backend
          const report = r.headers.get("X-DocSafe-Report") || "";

          const blob = await r.blob();
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          const ext = (f.name.split(".").pop()||"").toLowerCase();
          a.download = f.name.replace(/\.[^.]+$/,"") + "_cleaned." + ext;
          a.textContent = "T√©l√©charger le fichier nettoy√©";
          a.className = "btn alt";
          out.appendChild(a);

          // Affiche le rapport s‚Äôil existe
          msg.textContent = report ? `Termin√© ‚úîÔ∏è ‚Äî ${report}` : "Termin√© ‚úîÔ∏è";

        } catch(e) {
          msg.textContent = e.message.includes("Failed to fetch")
            ? "R√©seau/CORS : v√©rifie l‚ÄôURL API (HTTPS) et r√©essaie apr√®s /health."
            : e.message;
          console.error(e);
        }
      };
    </script>
  </body>
</html>
