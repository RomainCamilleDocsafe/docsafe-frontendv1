<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DocSafe â€” BÃªta V1</title>
<style>
  :root { --bg:#0b1220; --panel:#0f1730; --txt:#e6e9f2; --muted:#92a0bd; --acc:#3b82f6; --ok:#16a34a; --err:#ef4444; }
  html,body{margin:0;background:var(--bg);color:var(--txt);font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial,sans-serif;}
  .wrap{max-width:980px;margin:40px auto;padding:0 16px;}
  h1{font-size:28px;margin:0 0 6px}
  .muted{color:var(--muted);font-size:14px}
  .cards{display:flex;gap:12px;margin:16px 0 20px;flex-wrap:wrap}
  .chip{background:var(--panel);border:1px solid #1e2a48;border-radius:12px;padding:10px 14px;font-size:14px}
  .panel{background:var(--panel);border:1px solid #1e2a48;border-radius:14px;padding:18px}
  .grid{display:grid;grid-template-columns:2fr 1fr;gap:16px}
  .btn{background:var(--acc);border:none;color:white;border-radius:10px;padding:10px 14px;font-weight:600;cursor:pointer}
  .btn:disabled{opacity:.6;cursor:not-allowed}
  input[type=file]{background:#0b132b;border:1px solid #1f2a4a;color:#c7d2fe;padding:8px;border-radius:8px}
  .msg{margin-top:8px;font-size:14px}
  .alt{background:#0b132b;border:1px solid #2a3a67;color:#c7d2fe}
  .report{margin-top:12px;font-size:13px;color:#a9b7d9;white-space:pre-wrap}
</style>
</head>
<body>
<div class="wrap">
  <h1>DocSafe â€” BÃªta V1 (gratuite)</h1>
  <div class="muted">Nettoyez vos documents avant envoi (grammaire & typographie basiques, mÃ©tadonnÃ©es, mise en forme). PDF/DOCX/PPTX/XLSX/TXT.</div>

  <div class="cards">
    <div class="chip">âš¡ 1 clic</div>
    <div class="chip">ðŸš€ ImmÃ©diat</div>
    <div class="chip">ðŸ§© PDF/DOCX/PPTX/XLSX/TXT</div>
  </div>

  <div class="grid">
    <div class="panel">
      <h3>Clean & Download</h3>
      <input id="f" type="file" />
      <button id="go" class="btn" style="margin-left:8px">Nettoyer mon fichier</button>
      <div id="msg" class="msg"></div>
      <div id="out" class="report"></div>
    </div>
    <div class="panel">
      <h3>Rejoindre la bÃªta</h3>
      <div class="muted">Laissez votre email sur LinkedIn / DM pour accÃ¨s prioritaire.</div>
    </div>
  </div>

  <div class="panel" style="margin-top:16px">
    <strong>Limites bÃªta :</strong> 25&nbsp;MB / fichier, 20 fichiers / jour / IP.
  </div>
</div>

<script>
  // âš ï¸ Mets lâ€™URL de ton backend Render ici :
  const API = "https://docsafe-backendv1.onrender.com";

  const f   = document.getElementById("f");
  const go  = document.getElementById("go");
  const msg = document.getElementById("msg");
  const out = document.getElementById("out");

  go.onclick = async () => {
    out.textContent = "";
    msg.textContent = "";
    if (!f.files || f.files.length === 0) {
      msg.textContent = "Choisissez un fichier.";
      return;
    }
    const file = f.files[0];
    const form = new FormData();
    form.append("file", file);

    go.disabled = true;
    msg.textContent = "Traitement en coursâ€¦";

    try {
      const r = await fetch(API + "/api/clean", { method:"POST", body: form });
      if (!r.ok) {
        let err = "Erreur serveur";
        try { err = (await r.json()).error || err; } catch {}
        throw new Error(err + " (HTTP " + r.status + ")");
      }
      const report = r.headers.get("X-DocSafe-Report");
      const blob = await r.blob();
      const url = URL.createObjectURL(blob);

      const a = document.createElement("a");
      a.href = url;
      const ext = (file.name.split(".").pop()||"").toLowerCase();
      a.download = file.name.replace(/\.[^.]+$/,"") + "_cleaned." + ext;
      a.textContent = "TÃ©lÃ©charger le fichier nettoyÃ©";
      a.className = "btn alt";
      out.appendChild(a);

      if (report) {
        const p = document.createElement("div");
        p.className = "report";
        p.textContent =
